/*!
* collab.js v0.4.0
* Copyright (c) 2013-2014 Denis Vuyka
* License: MIT
* http://www.opensource.org/licenses/mit-license.php
*/
angular.module("collabjs.directives").directive("menubar",["$location",function($location){"use strict";function mapLinks(element){var routePattern,link,url,i,links=element.find("a"),urlMap={};for($location.$$html5||(routePattern=/^\/#[^/]*/),i=0;i<links.length;i++)link=angular.element(links[i]),url=link.attr("href"),$location.$$html5?urlMap[url]=link.parent():urlMap[url.replace(routePattern,"")]=link.parent();return urlMap}return function(scope,element,attrs){function updateSelection(){element.find("li").removeClass(onClass);var urlMap=mapLinks(element),pathLink=urlMap[$location.path()]||urlMap[$location.url()];if(!pathLink&&subpaths){var path=$location.path(),parts=(0===path.indexOf("/")?path.substr(1):path).split("/");parts.length>0&&(pathLink=urlMap["/"+parts[0]])}pathLink&&(pathLink.addClass(onClass),"/search"===$location.path()&&pathLink.parents("li").addClass(onClass))}var onClass=attrs.menubar||"on",subpaths=attrs.subpaths||!1;scope.$on("$routeChangeSuccess",function(){updateSelection()}),updateSelection()}}]),angular.module("collabjs.directives").directive("ngCardLayout",["$timeout",function($timeout){"use strict";return{restrict:"A",scope:{ngItems:"="},link:function(scope,element){function performLayout(){layout&&layout.wookmarkInstance&&layout.wookmarkInstance.clear(),layout=element.find("> ul > li"),layout.wookmark({autoResize:!0,container:element,offset:15,outerOffset:10})}var layout;scope.$watchCollection("ngItems",function(){$timeout(performLayout,0)})}}}]),angular.module("collabjs.directives").directive("onDocumentClick",["$document",function($document){"use strict";return{restrict:"A",link:function(scope,element,attrs){$document.on("click",function(){scope.$apply(function(){scope.$eval(attrs.onDocumentClick)})})}}}]),angular.module("collabjs.directives").directive("onOutsideElementClick",["$document",function($document){"use strict";return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(e){e.stopPropagation()}),$document.on("click",function(){scope.$apply(function(){scope.$eval(attrs.onOutsideElementClick)})})}}}]),angular.module("collabjs.directives").directive("sidebar",["$location",function($location){"use strict";function mapLinks(element){var routePattern,link,url,i,links=element.find("a"),urlMap={};for($location.$$html5||(routePattern=/^\/#[^/]*/),i=0;i<links.length;i++)link=angular.element(links[i]),url=link.attr("href"),$location.$$html5?urlMap[url]=link:urlMap[url.replace(routePattern,"")]=link;return urlMap}return function(scope,element,attrs){function updateSelection(){currentLink&&currentLink.removeClass(onClass);var urlMap=mapLinks(element),pathLink=urlMap[$location.path()]||urlMap[$location.url()];if(!pathLink&&subpaths){var path=$location.path(),parts=(0===path.indexOf("/")?path.substr(1):path).split("/");parts.length>0&&(pathLink=urlMap["/"+parts[0]])}pathLink&&(currentLink=pathLink,currentLink.addClass(onClass))}var currentLink,onClass=attrs.sidebar||"on",subpaths=attrs.subpaths||!1;scope.$on("$routeChangeSuccess",function(){updateSelection()}),updateSelection()}}]);