extends layout

append sidebar-connect
  li.active
    a(href='/people/#{profile.account}/timeline')
      i.icon-user
      | &nbsp;@#{profile.account}

block content
  include shared/ko-timeline
  include shared/profile
  h3
    i.icon-list-ul
    | &nbsp;Posts

  p.lead(style='display: none', data-bind='visible: posts().length == 0') No posts found...

  div(style='display: none;', data-bind="visible: posts().length > 0, template: { name: 'timeline-template' }")  
  
  // Loading progress indicator
  div.page-spinner
    i.icon-spinner.icon-spin.icon-4x

  div.alert.alert-error.page-error

block scripts
  script.
    $(document).ready(function () {
      getPersonalTimeline('#{account}');
      initLazyLoading(getDataUrl, onFeedDataLoaded);
    });
    // smooth infinite scrolling
    //  (downloads additional posts as soon as user scrolls to the bottom)
    function getDataUrl() {
      var bottomPostId = Math.min.apply(this, $.map(window.timelineFeed.posts(), function (p) {
        return p.id;
      }));
      return '/api/people/#{account}/timeline?topId=' + bottomPostId;
    }