extends layout

block content
  include ko-timeline
  include tb-mixins
  
  p.lead#error(style='display: none;')
  h3#header(style='display: none;')
    i.icon-file-alt
    span#title(style='padding-left: 5px')
    
  // Loading progress indicator
  div#progress(style='text-align: center;')
    i.icon-spinner.icon-spin.icon-4x

  div(style='display: none;', data-bind="visible: posts().length > 0, template: { name: 'timeline-template' }")

block scripts
  script(src='/js/knockout-2.2.0.js', type='text/javascript')
  script(src='/js/moment.min.js', type='text/javascript')
  script(src='/js/collabjs.js', type='text/javascript')
  script(type='text/javascript')
    $(document).ready(function () {
      $.ajax({
        type: 'GET',
        dataType: 'json',
        url: '/api/timeline/posts/#{postId}',
        success: function (data, status) {
          $('#title').text(data.name);
          $('#header').show();
          onPostLoaded(data);
        },
        error: function (request, status, error) {
          $('#header').hide();
          $('#error').text('Post not found.').show();
        },
        complete: function () {
          $('#progress').hide();
        }
      });
    });
    function onPostLoaded(data) {
      window.viewmodel = new FeedViewModel(_currentUser, data);
      ko.applyBindings(window.viewmodel);
      enableAccountPopups();
      enableAccountTooltips();
      $('div[data-link-type="comment"]').collapse('show');
    }