script(type='text/html', id='timeline-template')
  div.row
    div.timeline-feed
      ul(data-bind='foreach: posts')
        li
          div.author
            a.account(data-bind="attr: { href: feed }")
              img(data-bind="attr: { src: picture }", alt='avatar')
          div.name
            a.account-name(data-bind='text: name, attr: { href: postUrl }')
            a.account(data-bind="text: '@' + account, attr: { href: feed }")
          div.date
            i.icon-time &nbsp;
            span(data-bind="text: created.calendar(), attr: { title : created.format('LLLL') }")
          div.delete(data-bind='click: $parent.dismissPost')
            i.icon-remove
          div.message
            div(data-bind='html: content')
            // ko if: openBlank
            a.no-decoration(data-bind='attr: { href: postUrl }')
              i.icon-comment.black
              span(data-bind="text: ' View all {0} comments'.formatString(commentsCount())")
            // /ko
            // ko ifnot: openBlank
            a.no-decoration(href='#', data-link-type='comment')
              i.icon-comment.black
              | &nbsp;Comments
              span(data-bind="visible: commentsCount() > 0, text: ' (' + commentsCount() + ')'")
            // /ko

          ul
            // ko foreach: comments
            li
              div.author
                img(data-bind="attr: { src: picture }", alt='')
              div.name(style='width:94%')
                strong(data-bind='text: name')
                a.account(data-bind="text: '@' + account, attr: { href: feed }")
              div.date
                i.icon-time &nbsp;
                span(data-bind="text: created.calendar(), attr: { title : created.format('LLLL') }")
              div.message(data-bind='html: content')
            // /ko
            li
              div.author(style='top: 4px;')
                img(data-bind="attr: { src: collabjs.currentUser.getPictureUrl() }", alt='')
              form(method='post', action='', onSubmit='collabjs.ui.doPostComment(this); return false;', role='form')
                input(type='hidden', name='_csrf', value=collabjs.token)
                input(name='postId', type='hidden', data-bind='value: id')
                input.form-control(name='content', type='text', placeholder='Write a comment...', autocomplete='off'
                  data-bind="attr: { id: 'comment-box-' + id }")